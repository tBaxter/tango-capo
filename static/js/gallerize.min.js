/***********************************************
* Gallerize creates responsive,
* mobile-friendly HTML5 photo galleries.
*
* It supports navigation by keyboard, previous/next buttons,
* thumbnails and clicking the current photo.
*
* There are several pre-requisites:
* - Modernizr
* - Swipe.js
* - Cycle
* - jcarousellite (if using thumbs)
*
***********************************************/function gallerize(){function u(e){$(e).find("img").length===0&&$(e).prepend('<img alt="" src="'+$(e).attr("data-load-on-demand")+'">')}function a(e){u(e);u($(e).next());var n=$(e).find(".caption").html();o.html()!==n&&o.html(n);t=$(e).attr("id").replace("image_","");$("#photoset_index").html(t);if(r){r.removeClass("current");r.eq(t).addClass("current")}t>1&&typeof _gaq!="undefined"&&_gaq.push(["_trackPageview"])}function f(){var e=$("#photoset_slides_hold"),r=new Swipe(e.get(0),{startSlide:t,speed:400,callback:function(t,r,i){var s=n.eq(r);a(s);if(r>1){var o=s.find("img").height();e.height(o+20)}}});return r}function l(){$("#photoset_slides").cycle({speed:100,pause:1,nowrap:1,timeout:0,startingSlide:t,slideResize:0,fx:"scrollHorz",activePagerClass:"current",prev:s,next:i,pager:r,pagerAnchorBuilder:function(e,t){return"ul#photoset_thumbs li:eq("+e+") "},before:function(e,t,n){a(t)}})}var e,t=0,n=$("#photoset_slides > figure"),r=$("#photoset_thumbs li"),i=$("#photoset_info .next"),s=$("#photoset_info .prev"),o=$("#caption_hold");if(n.size()>1){if(window.location.hash&&window.location.hash.indexOf("slide-")!==-1){t=$(window.location.hash.replace("slide-","image_")).index();$("#photoset_index").html(t+1)}if(Modernizr.csstransforms){e=f();a(n.eq(t));t-=1}else e=l();n.each(function(){$(this).attr("title","Click or swipe for next photo")});if(Modernizr.touch===!1&&$(document).width()>780&&r.length>0){$("*[data-deferred-thumbs]").prepend(function(){var e=$(this).attr("data-deferred-thumbs");return'<img alt="" src="'+e+'">'});r.jcarousel({scroll:1,visible:12,animation:200,itemFirstInCallback:function(e,t,n,i){r.find("li").removeClass("current");$(t).addClass("current")},setupCallback:function(){$("#photoset_thumbs_hold").show()}});r=r.data("jcarousel")}i.click(function(){e.next();r&&r.next()});s.click(function(){e.prev();r&&r.prev()});n.click(i.click());$(document).keydown(function(e){e.which===37?s.click():e.which===39&&i.click()})}}gallerize();